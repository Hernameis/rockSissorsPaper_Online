package com.mukzzibba.server;

import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.io.OutputStreamWriter;
import java.net.Socket;
import java.util.GregorianCalendar;

public class ClientListener extends Thread{
	Socket sock;
	InputStream is;
	OutputStream os;
	InputStreamReader isr;
	OutputStreamWriter osw;
	StreamOpener so;
	StreamOpener sc;
	
	String command="";
	int isNext;
	
	public ClientListener(Socket sock) {
		so=new StreamOpener();
		this.sock=sock;
		run();
	}
	
	@Override
	public void run() {
		is=so.OpeninputStream(sock);
		isr=so.OpeninputStreamReader(sock,is);
		os=so.OpenoutputStream(sock);
		osw=so.OpenoutputStreamWriter(sock,os);
		
		while(true) {
			command="";
			try {
				isNext=is.read();
				System.out.println(isNext);
				if(isNext!=-1){
					command=""+(char)isNext;
					for(int i=0; i<3; i++){
						command+=(char)is.read();
					}
				}
				System.out.println("command "+command);
				if(command.equals("bye1")){ break; }
			} catch (IOException e1) {
				// TODO Auto-generated catch block
				e1.printStackTrace();
			}
			try {
				Thread.sleep(1000);
			} catch (InterruptedException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
			
		}
		System.out.println("유저가 접속을 종료했습니다");
		StreamCloser.closeInputStream(is);
		StreamCloser.closeInputStreamReader(isr);
		StreamCloser.closeOutputStream(os);
		StreamCloser.closeOutputStreamWriter(osw);
	}
}
