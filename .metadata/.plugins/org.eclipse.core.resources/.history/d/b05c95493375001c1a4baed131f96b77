package com.mukzzibba.server;

import java.io.BufferedWriter;
import java.io.IOException;
import java.io.OutputStream;
import java.io.OutputStreamWriter;
import java.net.Socket;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.LinkedList;
import java.util.Queue;

public class ChatWriter{
	
	private static HashMap<String, Socket> userSockets;
	private static HashSet<String> onlineUsers;
	Iterator<String> ite;
	
	private static Queue<String> strTosay;
	private Socket sock;
	String strToWrite;
	String name;
	
	BufferedWriter bw;
	
	public ChatWriter(){
		strTosay=new LinkedList<String>();
		while(true) {
			if(!strTosay.isEmpty()){
				strToWrite=strTosay.poll();
				ite=onlineUsers.iterator();
				while(ite.hasNext()){
					name=ite.next();
					sock=userSockets.get(name);
					bw=openWriteStream(sock);
					useBufferedStream(bw, strToWrite);
				}
			}
		}
	}
	
	private static BufferedWriter openWriteStream(Socket sock){
		OutputStream os =null;
		OutputStreamWriter osw=null;
		BufferedWriter bw=null;
		
		try {
			os=sock.getOutputStream();
			osw=new OutputStreamWriter(os);
			bw=new BufferedWriter(osw);
		} catch (IOException e) {
			e.printStackTrace();
		}
		return bw;
	}
	
	private static void useBufferedStream(BufferedWriter bw, String msg){
		try {
			bw.write(msg);
		} catch (IOException e) {
			e.printStackTrace();
		}
	}
}
